# 2. 关系数据库

## 2.1 关系--关系模式的数据结构

- 域:相同数据类型的集合

- 笛卡尔积:
  $$
  R \times S = \{ (r, s) \mid r \in R, s \in S \} \
  $$
  ![image-20250607202401725](C:\Users\32770\AppData\Roaming\Typora\typora-user-images\image-20250607202401725.png)

- 基数: 关系包含的元组个数

  - 假设关系  S （课程表：课程号，课程名）包含 2 个元组：
    $$
    S = \{(C1, 数学), (C2, 英语)\}
    $$
    例:

    ![image-20250607203024398](C:\Users\32770\AppData\Roaming\Typora\typora-user-images\image-20250607203024398.png)

- 关系:
  $$
  R \subseteq D_1 \times D_2 \times \dots \times D_n
  $$

  - R:关系名
  - n:关系的目或者度

- 单元关系与二元关系

  - n = 1:一元关系
  - n = 2:二元关系

- 元组:关系中的每个元素,通常用t表示

- 关系的表示:关系也是一个二维表,行对应元组,列对应域

- 属性:

  - 不同列对于不同域
  - 每一列取一个名字,叫做域
  - n目关系必须有n个列

- 码:

  - 候选码:一个属性就能确定一个元组
  - 全码:所以属性都有才能确定一个元组
  - 主码:存在多个候选码,选其中一个作为主码
  - 主属性:候选码的诸属性
  - 非主属性非(非码属性):不包含在任何候选码中的属性

- 三类关系(三类表):
  - 基本关系(基本表或基表):实际存在的表,是存储数据的逻辑表示
  - 查询表:查询结果对应的表
  - 视图表:有基本表或其他视图表导出的表,是虚表,不对呀实际存储的数据

- 基本关系的性质
  - 列同质
  - 不同列可以出自同一域
  - 行列的顺序无所谓
  - 任意两元组候选码不能相同,相同则为重复元组
  - **分量必须不可分**

## 2.2 关系模式及关系数据库

### 2.2.1 关系模式

- 关系模式:
  $$
  R(A, U, DOM, F)
  $$

  - R:关系名
  - U:组成该关系的属性名集合
  - D:U中属性所来自的域
  - DOM:属性向域的映像集合
  - F:属性之间数据的依赖关系的集合
  - 或表示为:

  $$
   R(A_1, A_2, \dots, A_n) 
  $$

  - R:关系名
  - A:属性名

- 关系与关系模式的联系

  - 参考面向对象,关系模式类似于对象(抽象的,不可变的)
  - 而关系类似于实现类(具体的,可变的)

### 2.2.2 关系数据库

**形式化描述：关系数据库由一组关系模式及其对应的关系实例组成，遵循关系模型的结构、操作和完整性约束。**

## 2.3 关系操纵

- 两种类型
  - 查询操纵(5种基本操作)
    - 选择
    - 投影
    - 并
    - 差
    - 笛卡尔积
  - 数据更新
    - 插入
    - 删除
    - 修改

- 特点
  - 操作对象都是集合

- 关系数据库语言的分类
  - 关系代数
  - 关系演算
    - 元组关系演算
    - 域关系演算
  - SQL语言

## 2.4 关系完整性

- 实体完整性(必须)

  - 主属性(主码中的属性)不能取空值

- 参照完整性(必须)

  - 引用的主码必须完整存在

    > 学生(学号[主码],课程号[外码])[参照关系]
    >
    > 课程(课程号[主码],课程名)[被参照关系]
    >
    > **学生所包含的课程号,必须是确实存在的课程**

- 用户定义完整性

  - 符合实情况的约束

    > 性别只能是男或女

## 2.5 关系代数

- 五种基本运算✨✨✨
  - 并
  - 差
  - 笛卡尔积
  - 选择
  - 投影

### 2.5.1 传统集合运算

- 并

  - $$
     R \cup S = \{ t \mid t \in R \lor t \in S \} 
    $$

    

- 差

  - $$
     R - S = \{ t \mid t \in R \land t \notin S \} 
    $$

    

- 交

  - $$
     R \cap S = \{ t \mid t \in R \land t \in S \} 
    $$

    

- (广义)笛卡尔积

  - $$
    R \times S = \{ (r, s) \mid r \in R, s \in S \} 
    $$

    

### 2.5.2 专门的关系运算✨✨✨

- 选择

  - $$
    \sigma_{条件}(R) = \{ t \mid t \in R \land 条件(t) \}
    $$
	
	> $$
	> \begin{array}{ |c|c|c| }
	> \hline
	> Sno & Sname & Sdept \\
	> \hline
	> 001 & 张三 & 计算机 \\
	> 002 & 李四 & 数学 \\
	> \hline
	> \end{array}
	> $$
	> 
	>
	
	> $$
	> 
	> $$
	> $$
	> \sigma_{Sdept='计算机'}(Student) = \{(001, 张三, 计算机)\}
	> \
	> $$
	>
	> 
	
- 投影

  - $$
    \pi_{A_1, A_2, \dots, A_k}(R) = \{ t[A_1, A_2, \dots, A_k] \mid t \in R \}
    $$

    > $$
    > \pi_{Sname}(Student) = \{(\text{张三}), (\text{李四})\}
    > $$
    >
    > 

- 连接

  - - 等值连接

      - $$
        R \bowtie_{R.A=S.B} S = \sigma_{R.A=S.B}(R \times S)
        $$
  
        ![image-20250608153915388](C:\Users\32770\AppData\Roaming\Typora\typora-user-images\image-20250608153915388.png)
  
  ​	 
  
  - 自然连接
  
    - $$
      R \bowtie S = \{ t \mid t[A] \in R, t[B] \in S, t[A \cap B] = t[A] \cap t[B] \}
      $$
      
      ![image-20250608154000120](C:\Users\32770\AppData\Roaming\Typora\typora-user-images\image-20250608154000120.png)
  
    > 外连接:
    >
    > ![image-20250608154241393](C:\Users\32770\AppData\Roaming\Typora\typora-user-images\image-20250608154241393.png)

- 除

  - $$
    R \div S = \{ t[A] \mid t \in R, \forall s \in S, (t[A], s[B]) \in R \}
    $$

    - > $$
      >  R(Sno, Cno) = \{(001, C1), (001, C2), (002, C1)\} ,
      > S(Cno) = \{(C1), (C2)\} 
      > $$
      >
      > 

      > $$
      > R \div S = \{(001)\}
      > $$
      >
      > 

![image-20250608154732762](C:\Users\32770\AppData\Roaming\Typora\typora-user-images\image-20250608154732762.png)

